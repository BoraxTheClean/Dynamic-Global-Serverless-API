---
AWSTemplateFormatVersion: "2010-09-09"
Transform: AWS::Serverless-2016-10-31

Description: >
  Deploys an api behind cloudfront that dumps headers.

Resources:
    ReturnHeadersFunction:
      Type: AWS::Serverless::Function
      Properties:
          FunctionName: list-headers
          CodeUri: dist/
          Handler: handler.handler
          Runtime: python3.8
          Timeout: 29
          Tracing: Active
          AutoPublishAlias: live
          DeploymentPreference:
              #Change to Canary10Percent5Minutes after developemnt
              Type: AllAtOnce
          MemorySize: 128
          Events:
            APIGateway:
              Type: Api
              Properties:
                Path: /
                Method: GET

      Distro:
        Type: AWS::CloudFront::Distribution
        Properties:
          DistributionConfig:
            DefaultCacheBehavior:
              AllowedMethods:
                - GET
                - HEAD
              TargetOriginId: 1
              ViewerProtocolPolicy: redirect-to-https
            Enabled: True
            HttpVersion: http2
            Origins:                # required, list of Origin
              -
                CustomOriginConfig:
                  CustomOriginConfig
                DomainName: 554jrr4221.execute-api.us-east-1.amazonaws.com
                Id: 1
                OriginPath: /Prod
            PriceClass: PriceClass_100
